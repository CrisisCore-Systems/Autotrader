<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <!-- Content Security Policy: Prevent XSS attacks -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'unsafe-inline'; script-src 'none'; object-src 'none'; base-uri 'self'; form-action 'self';" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="AutoTrader GemScore Analysis Artifact - Memorywear Entry" />
  <title>Collapse Artifact</title>
  <!--
    SECURITY NOTE FOR DEVELOPERS:
    - This template uses static placeholders (e.g., id="artifact-score")
    - When dynamically injecting content, ALWAYS sanitize user input
    - Use textContent (not innerHTML) for dynamic data insertion
    - Avoid inline event handlers and eval()
    - For JSON data, use JSON.parse() safely within try-catch
    - Validate all numeric values before display
    - Example safe injection:
      document.getElementById('artifact-score').textContent = sanitize(data.score);
  -->
  <style>
    :root {
      --bg: #050608;
      --fg: #f5f3f0;
      --accent: #7f5af0;
      --warning: #ff5470;
      --muted: #6b7280;
      font-family: 'IBM Plex Mono', monospace;
    }
    body {
      background: radial-gradient(circle at top, #111322 0%, #050608 65%);
      color: var(--fg);
      padding: 3rem;
      line-height: 1.6;
    }
    .frame {
      border: 1px solid rgba(127, 90, 240, 0.4);
      padding: 2rem;
      box-shadow: 0 0 40px rgba(127, 90, 240, 0.35);
      position: relative;
    }
    .glyph {
      position: absolute;
      top: -1.5rem;
      right: 2rem;
      font-size: 2.75rem;
      color: var(--accent);
    }
    h1 {
      font-size: 2.2rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-bottom: 0.5rem;
    }
    .meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .meta span {
      display: block;
      color: var(--muted);
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    .meta strong {
      font-size: 1.2rem;
      color: var(--fg);
    }
    section {
      margin-bottom: 2rem;
    }
    section h2 {
      font-size: 1rem;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.2em;
      margin-bottom: 0.5rem;
    }
    .flags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .flag {
      border: 1px solid var(--accent);
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      letter-spacing: 0.05em;
    }
    .footer {
      font-size: 0.75rem;
      color: var(--muted);
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="frame">
    <div class="glyph">⧗⟡</div>
    <h1 id="token-title">[TOKEN] — Memorywear Entry</h1>
    <div class="meta">
      <div>
        <span>Date</span>
        <strong id="artifact-date">2025-10-01T12:00:00Z</strong>
      </div>
      <div>
        <span>GemScore</span>
        <strong id="artifact-score">72.5</strong>
      </div>
      <div>
        <span>Confidence</span>
        <strong id="artifact-confidence">85%</strong>
        <!-- Expected: 0-1 float, displayed as percentage. Example: 0.85 → "85%" -->
      </div>
      <div>
        <span>Narrative Volatility Index</span>
        <strong id="artifact-nvi">0.68</strong>
      </div>
      <div>
        <span>Flags</span>
        <div class="flags" id="artifact-flags">
          <span class="flag">Accumulation</span>
          <span class="flag">VerifiedContract</span>
          <span class="flag">MediumLiquidity</span>
        </div>
      </div>
    </div>

    <section>
      <h2>Lore</h2>
      <p id="artifact-lore">The chorus tightens — wallets whisper in clusters; commit pulses from the repo. The market breathes.</p>
    </section>

    <section>
      <h2>Data Snapshot</h2>
      <ul id="artifact-data">
        <li>Price (24h): $0.032</li>
        <li>TVL change (7d): +21%</li>
        <li>Top wallet %: 12.4%</li>
      </ul>
    </section>

    <section>
      <h2>Action Notes</h2>
      <p id="artifact-actions">Suggested: human review; place small tranche if risk tolerance &gt; X. Watch: vesting date 2025-11-05.</p>
    </section>

    <div class="footer">
      Collapse Artifact v1.0 — Hash: <span id="artifact-hash">sha256(...)</span>
    </div>
  </div>

  <!--
    DYNAMIC CONTENT INJECTION GUIDE:
    
    To safely populate this template with dynamic data:
    
    1. SANITIZE ALL INPUT:
       - HTML-encode special characters: & < > " '
       - Validate numeric ranges (score: 0-100, confidence: 0-1)
       - Strip script tags and event handlers
    
    2. USE SAFE DOM METHODS:
       // SAFE ✅
       element.textContent = userInput;
       element.setAttribute('data-value', sanitizedValue);
       
       // UNSAFE ❌ 
       element.innerHTML = userInput;  // Can execute scripts!
       element.outerHTML = userInput;   // Dangerous!
    
    3. EXAMPLE SAFE INJECTION (JavaScript):
       function updateArtifact(data) {
         // Validate and sanitize
         const score = Math.max(0, Math.min(100, parseFloat(data.score) || 0));
         const confidence = Math.max(0, Math.min(1, parseFloat(data.confidence) || 0));
         
         // Safe updates using textContent
         document.getElementById('token-title').textContent = 
           sanitizeHTML(data.token) + ' — Memorywear Entry';
         document.getElementById('artifact-score').textContent = score.toFixed(1);
         document.getElementById('artifact-confidence').textContent = 
           (confidence * 100).toFixed(0) + '%';
         document.getElementById('artifact-lore').textContent = sanitizeHTML(data.lore);
       }
       
       function sanitizeHTML(str) {
         const div = document.createElement('div');
         div.textContent = str;
         return div.innerHTML;
       }
    
    4. PYTHON BACKEND SANITIZATION:
       from html import escape
       from markupsafe import Markup
       
       def render_artifact(data):
           return template.render(
               token=escape(data['token']),
               score=max(0, min(100, float(data['score']))),
               confidence=max(0, min(1, float(data['confidence']))),
               lore=escape(data['lore'])[:10000]  # Length limit
           )
    
    5. VALIDATION CHECKLIST:
       ☑ All user input HTML-escaped
       ☑ Numeric values range-validated
       ☑ String length limits enforced
       ☑ No innerHTML usage for user data
       ☑ CSP headers properly configured
       ☑ No inline JavaScript event handlers
  -->
</body>
</html>
