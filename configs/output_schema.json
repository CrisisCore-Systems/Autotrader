{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://autotrader.dev/schemas/scanner-output.json",
  "title": "AutoTrader Scanner Output",
  "description": "JSON schema for validating AutoTrader scanner output to prevent silent shape drift",
  "type": "object",
  "required": ["tokens", "metadata", "timestamp"],
  "properties": {
    "tokens": {
      "type": "array",
      "description": "List of scanned token results",
      "items": {
        "$ref": "#/definitions/token_result"
      }
    },
    "metadata": {
      "$ref": "#/definitions/metadata"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of scan execution"
    },
    "config": {
      "$ref": "#/definitions/scan_config"
    },
    "metrics": {
      "$ref": "#/definitions/metrics"
    }
  },
  "definitions": {
    "token_result": {
      "type": "object",
      "required": ["symbol", "gem_score", "status"],
      "properties": {
        "symbol": {
          "type": "string",
          "pattern": "^[A-Z0-9]{2,10}$",
          "description": "Token symbol (uppercase alphanumeric)"
        },
        "coingecko_id": {
          "type": "string",
          "description": "CoinGecko identifier"
        },
        "contract_address": {
          "type": "string",
          "pattern": "^0x[a-fA-F0-9]{40}$",
          "description": "Ethereum contract address"
        },
        "gem_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Overall gem score (0-100)"
        },
        "status": {
          "type": "string",
          "enum": ["success", "partial", "failed"],
          "description": "Scan completion status"
        },
        "scores": {
          "$ref": "#/definitions/component_scores"
        },
        "market_data": {
          "$ref": "#/definitions/market_data"
        },
        "defi_metrics": {
          "$ref": "#/definitions/defi_metrics"
        },
        "contract_analysis": {
          "$ref": "#/definitions/contract_analysis"
        },
        "narratives": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Market narratives and catalysts"
        },
        "unlocks": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/unlock_event"
          },
          "description": "Token unlock events"
        },
        "artifacts": {
          "$ref": "#/definitions/artifacts"
        },
        "errors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Error messages if status is not success"
        }
      }
    },
    "component_scores": {
      "type": "object",
      "description": "Individual component scores",
      "properties": {
        "liquidity": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "momentum": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "protocol_health": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "security": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "narrative": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        }
      }
    },
    "market_data": {
      "type": "object",
      "properties": {
        "price_usd": {
          "type": "number",
          "minimum": 0
        },
        "price_change_7d": {
          "type": "number"
        },
        "price_change_30d": {
          "type": "number"
        },
        "volume_24h": {
          "type": "number",
          "minimum": 0
        },
        "market_cap": {
          "type": "number",
          "minimum": 0
        },
        "liquidity_usd": {
          "type": "number",
          "minimum": 0
        }
      }
    },
    "defi_metrics": {
      "type": "object",
      "properties": {
        "tvl_usd": {
          "type": "number",
          "minimum": 0
        },
        "tvl_change_7d": {
          "type": "number"
        },
        "active_users": {
          "type": "integer",
          "minimum": 0
        },
        "holders": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "contract_analysis": {
      "type": "object",
      "properties": {
        "verified": {
          "type": "boolean"
        },
        "security_severity": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        },
        "audit_status": {
          "type": "string",
          "enum": ["audited", "unaudited", "unknown"]
        },
        "holder_count": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "unlock_event": {
      "type": "object",
      "required": ["date", "percent_supply"],
      "properties": {
        "date": {
          "type": "string",
          "format": "date-time",
          "description": "Unlock date (ISO 8601)"
        },
        "percent_supply": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Percentage of supply unlocked"
        }
      }
    },
    "artifacts": {
      "type": "object",
      "properties": {
        "markdown_path": {
          "type": "string",
          "description": "Path to markdown artifact"
        },
        "html_path": {
          "type": "string",
          "description": "Path to HTML artifact"
        },
        "tree_json_path": {
          "type": "string",
          "description": "Path to tree-of-thought JSON"
        }
      }
    },
    "metadata": {
      "type": "object",
      "required": ["version", "strategy", "duration_seconds"],
      "properties": {
        "version": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
          "description": "AutoTrader version (semver)"
        },
        "strategy": {
          "type": "string",
          "description": "Strategy name used for scan"
        },
        "duration_seconds": {
          "type": "number",
          "minimum": 0,
          "description": "Total scan duration"
        },
        "tokens_processed": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of tokens processed"
        },
        "tokens_successful": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of successful scans"
        },
        "tokens_failed": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of failed scans"
        }
      }
    },
    "scan_config": {
      "type": "object",
      "description": "Configuration used for scan",
      "properties": {
        "liquidity_threshold": {
          "type": "number",
          "minimum": 0
        },
        "deterministic": {
          "type": "boolean"
        },
        "seed": {
          "type": "integer"
        },
        "strategy_params": {
          "type": "object",
          "description": "Strategy-specific parameters"
        }
      }
    },
    "metrics": {
      "type": "object",
      "description": "Performance and telemetry metrics",
      "properties": {
        "api_calls": {
          "type": "object",
          "properties": {
            "coingecko": {
              "type": "integer",
              "minimum": 0
            },
            "defillama": {
              "type": "integer",
              "minimum": 0
            },
            "etherscan": {
              "type": "integer",
              "minimum": 0
            }
          }
        },
        "cache_hits": {
          "type": "integer",
          "minimum": 0
        },
        "cache_misses": {
          "type": "integer",
          "minimum": 0
        },
        "errors": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string"
              },
              "message": {
                "type": "string"
              },
              "count": {
                "type": "integer",
                "minimum": 0
              }
            }
          }
        }
      }
    }
  }
}
